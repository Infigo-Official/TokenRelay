services:
  tokenrelay:
    build:
      context: .
      dockerfile: docker/Dockerfile
      args:
        VERSION: 1.13.1
    container_name: tokenrelay-local-test
    ports:
      - "5163:80"
    environment:
      - ASPNETCORE_ENVIRONMENT=Development
      - ASPNETCORE_URLS=http://+:80
      - ConfigPath=/app/tokenrelay.json
      - TOKENRELAY_CONFIG_MODE=file
    volumes:
      - ./docker/config/tokenrelay-local.json:/app/tokenrelay.json:ro
      - ./docker/uploads:/app/uploads
      - ./docker/logs:/app/logs
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:80/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

networks:
  default:
    name: tokenrelay-local-network
