meta {
  name: Proxy to OAuth API - Password Grant
  type: http
  seq: 1
}

get {
  url: {{tokenrelay_url}}/proxy/users
  body: none
  auth: none
}

headers {
  TOKEN-RELAY-TARGET: oauth-test-api
  TOKEN-RELAY-AUTH: {{tokenrelay_auth_token}}
}

docs {
  # TokenRelay OAuth Proxy - Password Grant

  This request demonstrates TokenRelay's automatic OAuth token acquisition using the password grant flow.

  ## How It Works
  1. TokenRelay receives your request
  2. Checks if it has a valid cached OAuth token for the target
  3. If not cached or expired:
     - Requests a new token from the OAuth server using configured credentials
     - Caches the token for future requests
  4. Injects the OAuth token into the Authorization header
  5. Forwards the request to the target API

  ## Configuration
  The `oauth-test-api` target is configured in `tokenrelay.json`:
  ```json
  {
    "authType": "oauth",
    "authData": {
      "token_endpoint": "http://oauth-server:8080/v1/oauth/tokens",
      "grant_type": "password",
      "username": "test_user",
      "password": "test_password",
      "client_id": "test_client_1",
      "client_secret": "test_secret_1"
    }
  }
  ```

  ## Monitoring
  Watch TokenRelay logs to see:
  - First request: OAuth token acquisition
  - Subsequent requests: Token retrieved from cache
  - Token expiration: Automatic refresh
}
