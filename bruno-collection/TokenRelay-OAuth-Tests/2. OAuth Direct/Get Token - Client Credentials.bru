meta {
  name: Get Token - Client Credentials
  type: http
  seq: 2
}

post {
  url: {{oauth_server_url}}/v1/oauth/tokens
  body: formUrlEncoded
  auth: basic
}

auth:basic {
  username: {{oauth_client_id}}
  password: {{oauth_client_secret}}
}

body:form-urlencoded {
  grant_type: client_credentials
  scope: read
}

script:post-response {
  if (res.status === 200) {
    const data = res.body;
    bru.setVar("oauth_access_token", data.access_token);
    console.log("OAuth token acquired:", data.access_token);
  }
}

docs {
  # OAuth2 Client Credentials Grant

  Request an access token using client credentials grant flow.

  ## Grant Type
  - **Type**: Client Credentials Grant
  - **Use Case**: Machine-to-machine authentication (no user context)

  ## Request Details
  - **Authentication**: Basic Auth (client_id:client_secret)
  - **Body**: Form URL Encoded
    - grant_type: client_credentials
    - scope: read

  ## Expected Response
  ```json
  {
    "access_token": "...",
    "token_type": "Bearer",
    "expires_in": 3600,
    "scope": "read"
  }
  ```

  The access token is automatically saved to the `oauth_access_token` variable.
}
