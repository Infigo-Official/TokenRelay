meta {
  name: Get Token - Password Grant
  type: http
  seq: 1
}

post {
  url: {{oauth_server_url}}/v1/oauth/tokens
  body: formUrlEncoded
  auth: basic
}

auth:basic {
  username: {{oauth_client_id}}
  password: {{oauth_client_secret}}
}

body:form-urlencoded {
  grant_type: password
  username: {{oauth_username}}
  password: {{oauth_password}}
  scope: read write
}

script:post-response {
  if (res.status === 200) {
    const data = res.body;
    bru.setVar("oauth_access_token", data.access_token);
    console.log("OAuth token acquired:", data.access_token);
  }
}

docs {
  # OAuth2 Password Grant

  Directly request an access token from the OAuth server using the password grant flow.

  ## Grant Type
  - **Type**: Resource Owner Password Credentials Grant
  - **Use Case**: When the client is trusted and can handle user credentials

  ## Request Details
  - **Authentication**: Basic Auth (client_id:client_secret)
  - **Body**: Form URL Encoded
    - grant_type: password
    - username: test_user
    - password: test_password
    - scope: read write

  ## Expected Response
  ```json
  {
    "access_token": "...",
    "token_type": "Bearer",
    "expires_in": 3600,
    "refresh_token": "...",
    "scope": "read write"
  }
  ```

  The access token is automatically saved to the `oauth_access_token` variable for use in subsequent requests.
}
