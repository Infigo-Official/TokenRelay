# TokenRelay Port Configuration Guide

When running TokenRelay as a standalone executable (not through IIS), the port is controlled by ASP.NET Core Kestrel configuration, not the web.config file.

## üéØ Quick Solutions

### Method 1: Environment Variable (Recommended)
```bash
# Windows (Command Prompt)
set ASPNETCORE_URLS=http://localhost:8080
TokenRelay.exe

# Windows (PowerShell)
$env:ASPNETCORE_URLS="http://localhost:8080"
.\TokenRelay.exe

# Linux/macOS
export ASPNETCORE_URLS=http://localhost:8080
./TokenRelay

# Multiple URLs (HTTP and HTTPS)
export ASPNETCORE_URLS="http://localhost:8080;https://localhost:8443"
```

### Method 2: Command Line Arguments
```bash
# Windows
TokenRelay.exe --urls "http://localhost:8080"

# Linux/macOS  
./TokenRelay --urls "http://localhost:8080"

# Multiple URLs
TokenRelay.exe --urls "http://localhost:8080;https://localhost:8443"
```

### Method 3: Configuration File (appsettings.json)
Add this to your appsettings.json or appsettings.Production.json:

```json
{
  "Kestrel": {
    "Endpoints": {
      "Http": {
        "Url": "http://localhost:8080"
      },
      "Https": {
        "Url": "https://localhost:8443"
      }
    }
  }
}
```

## üîß Permanent Configuration Solutions

### Option A: Update Startup Scripts
The startup scripts generated by publish-standalone.ps1 can be modified to set the port.

### Option B: Service Configuration
For Windows/Linux services, the port can be configured in the service definition.

### Option C: Docker Alternative
If you want to avoid port conflicts, you can map external ports to internal ports.

## üöÄ Implementation Examples

### For Windows Service
```batch
# In service.bat
sc create TokenRelay binPath= "\"C:\path\to\TokenRelay.exe\" --urls \"http://localhost:8080\""
```

### For Linux systemd
```ini
# In tokenrelay.service
Environment=ASPNETCORE_URLS=http://localhost:8080
```

### For Container-like Deployment
```bash
# Bind to all interfaces
export ASPNETCORE_URLS=http://0.0.0.0:8080
./TokenRelay
```

## ‚öôÔ∏è Configuration Priority Order

1. **Command line arguments** (highest priority)
2. **Environment variables**
3. **appsettings.{Environment}.json**
4. **appsettings.json**
5. **Default values** (lowest priority)

## üîç Troubleshooting

### Check Current Configuration
```bash
# The application will show the URLs it's listening on at startup
TokenRelay.exe
# Look for: "Now listening on: http://localhost:XXXX"
```

### Common Issues
- **Port already in use**: Change to a different port
- **Permission denied**: Use a port > 1024 or run as administrator
- **Firewall blocking**: Configure firewall rules for the new port
- **HTTPS certificate**: Ensure certificate is properly configured for HTTPS ports

## üìù Recommended Ports

| Environment | HTTP Port | HTTPS Port | Notes |
|------------|-----------|------------|-------|
| Development | 5163 | 7102 | Default from launchSettings.json |
| Testing | 8080 | 8443 | Common alternative ports |
| Production | 80 | 443 | Standard web ports (requires admin) |
| Production (Alt) | 5000 | 5001 | Common ASP.NET Core defaults |
| Production (Custom) | 8080 | 8443 | Behind reverse proxy |

## üõ°Ô∏è Security Considerations

### Binding to All Interfaces
```bash
# Bind to all network interfaces (less secure)
export ASPNETCORE_URLS=http://0.0.0.0:8080

# Bind to localhost only (more secure)
export ASPNETCORE_URLS=http://localhost:8080

# Bind to specific interface
export ASPNETCORE_URLS=http://192.168.1.100:8080
```

### Production Recommendations
- Use a reverse proxy (Nginx/IIS) for public-facing deployments
- Bind TokenRelay to localhost and let the proxy handle external access
- Use HTTPS with proper certificates for production
- Configure firewall rules appropriately
